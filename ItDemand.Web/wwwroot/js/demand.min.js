function peoplePickerFunc(){var n=$(this).parent().find("input:not(:hidden)"),t=$(this).parent().find(":hidden[name*='UserName']"),i=$(this).parent().find(":hidden[name*='Email']"),r=$(this).parent().find(":hidden[name*='.Id']");App.Dialogs.userSearch.show(function(u,f,e){u&&n.val(u);f&&t.val(f);e&&i.val(e);r.val(0)})}function clearPeoplePicker(){$(this).parent().find("input").val("")}function showSaveMsg(n){$("#saveMsg").html(n);$("#saveAlert").show()}function hideSaveMsg(){$("#saveAlert").hide()}function showValidationErrorsMsg(){$("#validationErrorsAlert").show()}function hideValidationErrorsMsg(){$("#validationErrorsAlert").hide()}function showNoNameErrorsMsg(){$("#noNameErrorAlert").show()}function hideNoNameErrorsMsg(){$("#noNameErrorAlert").hide()}function showStatusAlert(n,t){let i;switch(t){case"info":i="alert-info";break;case"warning":i="alert-warning";break;case"success":i="alert-success";break;default:i="alert-info"}$("#demandStatusFeedback").html("<div class='alert "+i+" role='alert'><a class='close' data-bs-dismiss='alert'><\/a><p style='margin-bottom: 0px;'>"+n+"<\/p><\/div>")}function clearStatusAlert(){$("#demandStatusFeedback").html("")}function count_chars_demandName(){document.getElementById("demandNameCharsCount").innerHTML=document.getElementById("Name").value.length}function count_chars(){document.getElementById("executiveDescCharsCount").innerHTML=document.getElementById("ExecutiveShortDescription").value.length}function isMedicalValidationSelected(){const n=$("option:selected","#ComplianceRelevant").text();return n.indexOf("Medical Validation")>=0?!0:!1}function SetBusinessDriverRequiredIndicators(){const n=$("#BusinessDriverId option:selected").text(),t=$("#BenefitsPerYear").parent().parent().find("label span"),i=$("#BenefitDuration").parent().find("span");n==="Cost Savings / Cost Reduction"||n==="Growth (Price / Volume / Increase Capability)"||n==="Strategic Investment"?(t.addClass("required-asterisk"),i.addClass("required-asterisk")):(t.removeClass("required-asterisk"),i.removeClass("required-asterisk"))}function disablePmoReviewControls(){const n=document.getElementById("IsPmo").value,t=document.getElementById("IsBusinessConsulting").value;n==="False"&&$(".pmo-only").attr("disabled","disabled");n==="False"&&t==="False"&&($(".gbc-only").attr("disabled","disabled"),$(document).off("click","span.assigned-sme:has(i.fa-user)",peoplePickerFunc),$(document).off("click","div.assigned-sme:has(i.fa-times)",clearPeoplePicker))}function handleAjaxError(n,t,i){const r='<div class="alert alert-danger" role="alert"><a class="close" data-bs-dismiss="alert"><\/a><p><strong>An error occurred while saving the form.<\/strong><\/p><p>Status Code: '+n.status+"<\/p><p>Error Thrown: "+i+"<\/p><\/div>";$("#errorMsg").html(r);console.log("ajax error [textStatus]: "+t);$(this).scrollTop(0)}function PmoReviewValidator(){let n=$("#DemandState").val();const t=$("#RequestCorrections option:selected").val();if(n==="PmoReview"&&t==="false"){const n=$("form").validate({rules:{NewApplication:{required:!0},ProposedPlatform:{required:!0},DecommissionRequired:{required:!0}},highlight:function(n){$(n).closest(".form-group").addClass("has-error")},unhighlight:function(n){$(n).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(n,t){const i=t.attr("multiple");typeof i!=typeof undefined&&i!==!1?n.insertAfter(t.next(".btn-group")):t.parent(".input-group").length?n.insertAfter(t.parent()):n.insertAfter(t)}});return n.form()}return!0}function demandSubmit(n){if(hideSaveMsg(),hideValidationErrorsMsg(),document.getElementById("Name").value)hideNoNameErrorsMsg();else{showNoNameErrorsMsg();return}App.Dialogs.busyBox.show("Saving, please wait...");$(".pmo-only").removeAttr("disabled");$(".gbc-only").removeAttr("disabled");const t=document.getElementById("demandRequestForm"),i=new FormData(t);return $("form:dirty").dirtyForms("setClean"),$.ajax({type:"POST",url:"/Demand/Save",processData:!1,contentType:!1,data:i,cache:!1,dataType:"json"}).done(function(t,i,r){if(t.success===!0){n&&(document.location=t.redirectUrl);t.demandId&&$("input[name='Id']").val(t.demandId);const i=$("input[name='Id']").val();showSaveMsg("<i class='fa fa-check' aria-hidden='true'><\/i> <strong>Save Successful:<\/strong> Demand-"+i+" was successfully saved.");typeof t.submittedForReview!="undefined"&&(console.log("submit for pmo review: ",t.submittedForReview),document.getElementById("SubmittedForReview").value=t.submittedForReview);typeof t.demandState!="undefined"&&(console.log("demandState: ",t.demandState),document.getElementById("DemandState").value=t.demandState)}else handleAjaxError(r,i,t.message)}).fail(function(n,t,i){handleAjaxError(n,t,i)}).always(function(){disablePmoReviewControls();App.Dialogs.busyBox.hide()}),!1}function addAttachmentRow(n,t){const i=n.find("tbody > tr").length,r="<tr><td><input type='file' name='Attachments["+i+"].File' id='Attachments["+i+"].File' style='width: 100%; display: inline-block; margin-top: 6px;' /><input type='hidden' name='Attachments["+i+"].FileName' value=''><\/input><\/td><td><\/td><td><\/td><td class='file-size-cell text-center'><span class='file-size-display' style='display: inline-block; margin-top: 6px;'><\/span><\/td><td class='text-center'><a href='javascript:void(0)' class='btn pointer deleteRow'><i class='fa fa-times'><\/i><\/a><\/td><\/tr>";n.append(r);t!==null&&$(r).find("i.fa-pencil-square-o").on("click",t).trigger("click")}function deleteAttachmentRow(n,t){let i=n.parents("table");App.Dialogs.confirm(t,function(t){t===!0&&(n.parents("tr").remove(),i.find("tbody > tr").each(function(n,t){$(t).find("input, textarea, select").each(function(t,i){let r=i.name.replace(new RegExp("[0-9+]"),n);$(i).attr({id:r,name:r});$(i).attr("name").indexOf("Index")>-1&&$(i).attr("value",n)})}),toggleAttachmentMsg())})}function toggleAttachmentMsg(){$("#attachmentTable tbody").children().length===0?$("#noAttachmentsMsg").show():$("#noAttachmentsMsg").hide()}function formatBytes(n,t){if(n===0)return"0 Byte";const i=1e3,u=t+1||3,r=Math.floor(Math.log(n)/Math.log(i));return parseFloat((n/Math.pow(i,r)).toFixed(u))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][r]}$(".datepicker:not(input[name='BenefitStart'])").datepicker({dateFormat:"M dd yy"});$("input[name='BenefitStart']").datepicker({dateFormat:"yy M"});$(document).off("click","div.input-group:has(i.fa-calendar)");$(document).on("click","div.input-group:has(i.fa-calendar)",function(){var n=$(this).find(".datepicker");$(n).datepicker("show")});$(document).off("click","div.input-group-overlay:has(i.fa-times)");$(document).on("click","div.input-group-overlay:has(i.fa-times):not(.assigned-sme)",clearPeoplePicker);$(document).on("click","div.assigned-sme:has(i.fa-times)",clearPeoplePicker);$(document).off("click","span.input-group-text:has(i.fa-user)");$(document).on("click","span.input-group-text:has(i.fa-user):not(.assigned-sme)",peoplePickerFunc);$(document).on("click","span.assigned-sme:has(i.fa-user)",peoplePickerFunc);$("#ComplianceRelevant").on("change",function(){const n=$("#MedicalValidationReference").parent().find("span");isMedicalValidationSelected()?($("#medicalReferenceCol").show(),n.addClass("required-asterisk")):($("#medicalReferenceCol").hide(),n.removeClass("required-asterisk"))});$("#BusinessUnitId").on("change",function(){const n=document.getElementById("BusinessUnitId"),t=n.options[n.selectedIndex].value;fetch("/Demand/GetItHead?businessUnitId="+t,{method:"GET"}).then(n=>n.json()).then(n=>{n.success===!0?(document.getElementById("ItHead.UserName").value=n.itHead.userName,document.getElementById("ItHead.Email").value=n.itHead.email,document.getElementById("ItHead.DisplayName").value=n.itHead.displayName):alert(n.message)})});$("#RequestCorrections").on("change",function(){const n=$("option:selected",this).val();n==="true"?$("#requestCorrectionsCommentsRow").slideDown():$("#requestCorrectionsCommentsRow").slideUp()});$("#BusinessDriverId").on("change",SetBusinessDriverRequiredIndicators);$(".numbers-only").keyup(function(){this.value=this.value.replace(/[^0-9]/g,"")});$("#ApplicationTypeId").on("change",function(){const t=$("option:selected",this).text(),n=$("#ProcessArea").parent().find("span");t==="Local"?($("#localApplicationRow").slideDown(),n.removeClass("required-asterisk")):($("#localApplicationRow").slideUp(),n.addClass("required-asterisk"))});$("#btnCancelDemand").click(function(){const n=parseInt(document.getElementsByName("Id")[0].value);App.Dialogs.confirm("<p>Are you sure you want to cancel this Demand?<\/p><p>A cancelled Demand may be reopened, but will reset to it's initially created state.<\/p>",function(t){t!==!1&&fetch("/Demand/Cancel/"+n,{method:"POST"}).then(n=>n.json()).then(n=>{n.success===!0?document.location=n.redirectUrl:alert(n.message)})})});$("#btnReinstate").click(function(){const n=parseInt(document.getElementsByName("Id")[0].value);fetch("/Demand/Reinstate/"+n,{method:"POST"}).then(n=>n.json()).then(n=>{n.success===!0?document.location=n.redirectUrl:alert(n.message)})});$("#btnDeleteDemand").click(function(){const n=parseInt(document.getElementsByName("Id")[0].value);App.Dialogs.confirm("<p>Are you sure you want to delete this Demand?<p><p><strong>Warning!<\/strong> This action will delete this Demand Entry from the system and cannot be undone!<\/p>",function(t){t!==!1&&fetch("/Demand/Delete/"+n,{method:"POST"}).then(n=>n.json()).then(n=>{n.success===!0?document.location=n.redirectUrl:alert(n.message)})})});$("#BusinessProcessL1Id").on("change",function(){const i=$("option:selected",this).val(),n=$("#BusinessProcessL2Id"),t=$("#BusinessProcessL3Id");n.find("option").not(":first").remove();t.find("option").not(":first").remove();n.prop("disabled",!0);t.prop("disabled",!0);fetch("/Demand/BusinessProcessL2Options?parentId="+i,{method:"GET"}).then(n=>n.json()).then(t=>{t.success===!0?t.options.length>0&&(t.options.map(function(t){const i=$("<option>");i.val(t.id).text(t.name);n.append(i)}),$("#BusinessProcessL2Id").prop("disabled",!1)):alert(t.message)})});$("#BusinessProcessL2Id").on("change",function(){const t=$("option:selected",this).val(),n=$("#BusinessProcessL3Id");n.find("option").not(":first").remove();n.prop("disabled",!0);fetch("/Demand/BusinessProcessL3Options?parentId="+t,{method:"GET"}).then(n=>n.json()).then(t=>{t.success===!0?t.options.length>0&&(t.options.map(function(t){const i=$("<option>");i.val(t.id).text(t.name);n.append(i)}),$("#BusinessProcessL3Id").prop("disabled",!1)):alert(t.message)})});$("#ProcessAreaId").on("change",function(){const t=$("option:selected",this).text();let n="";switch(t){case"HR":n="Human Resources";break;case"Procurement":n="Procurement";break;case"Finance & Controlling":n="Finance & Controlling";break;case"Customer Management":n="Customer Management";break;case"Order to Cash":n="Order to Cash";break;case"Cylinder Supply Chain":n="Supply Chain - Cylinder & Hardgood";break;case"Bulk & On-site Supply Chain":n="Supply Chain - Bulk"}$("#BusinessProcessL1Id option:contains("+n+")").attr("selected",!0).change()});$("#btnSaveSubmit").click(function(){$.validator.addMethod("multiSelectCheck",function(n,t){var i=$(t).find("option:selected").length;return i>0});const n=$("form").validate({rules:{Name:{required:!0},ProblemStatement:{required:!0},BusinessUnitId:{required:!0},AffectedBusinessUnits:{required:!0,multiSelectCheck:!0},ComplianceRelevant:{required:!0,multiSelectCheck:!0},UsersImpactedId:{required:!0},BusinessBenefit:{required:!0},ConsequenceNotImplemented:{required:!0},ScopeSummary:{required:!0},"RequestOwner.DisplayName":{required:!0},"RequestSponsor.DisplayName":{required:!0},"ProjectManager.DisplayName":{required:!0},"ItHead.DisplayName":{required:!0},EstimatedInternalEffort:{required:!0},EstimatedTotalCost:{required:!0},ApplicationTypeId:{required:!0},ApplicationDescription:{required:{depends:function(){return $("#ApplicationTypeId option:selected").text()==="Local"}}},BusinessDriverId:{required:!0},BenefitsPerYear:{required:{depends:function(){let n=$("#BusinessDriverId option:selected").text();return n==="Cost Savings / Cost Reduction"||n==="Growth (Price / Volume / Increase Capability)"||n==="Strategic Investment"}}},BenefitDuration:{required:{depends:function(){let n=$("#BusinessDriverId option:selected").text();return n==="Cost Savings / Cost Reduction"||n==="Growth (Price / Volume / Increase Capability)"||n==="Strategic Investment"}}},MedicalValidationReference:{required:{depends:function(){return isMedicalValidationSelected()}}},InterfaceChanges:{required:!0},SecurityAssessment:{required:!0},ItHead:{required:!0},ProcessAreaId:{required:{depends:function(){return $("#ApplicationTypeId option:selected").text()!=="Local"}}},BaselineCapex:{number:!0}},ignore:[':hidden:not("#AffectedBusinessUnits")',':hidden:not("#ComplianceRelevant")'],highlight:function(n){$(n).closest(".form-control").addClass("is-invalid");$(n).closest(".form-select").addClass("is-invalid");$(n).closest("button.form-select").addClass("is-invalid")},unhighlight:function(n){$(n).closest(".form-control").removeClass("is-invalid");$(n).closest(".form-select").removeClass("is-invalid");$(n).closest(".button.form-select").removeClass("is-invalid")},errorElement:"span",errorClass:"text-danger",errorPlacement:function(n,t){const i=t.attr("multiple");typeof i!=typeof undefined&&i!==!1?n.insertAfter(t.next(".btn-group")):t.parent(".input-group").length?n.insertAfter(t.parent()):n.insertAfter(t)}}),t=n.form();t?($("#SubmittedForReview").val(!0),demandSubmit(!0)):(hideSaveMsg(),showValidationErrorsMsg())});$("#btnSave").click(function(){let n=PmoReviewValidator();return n?demandSubmit(!1):(hideSaveMsg(),showValidationErrorsMsg()),!1});$("#demandRequestForm").submit(function(){let n=PmoReviewValidator();return n?demandSubmit(!0):(hideSaveMsg(),showValidationErrorsMsg()),!1});$(document).ready(function(){toggleAttachmentMsg();hideSaveMsg();hideValidationErrorsMsg();hideNoNameErrorsMsg();disablePmoReviewControls();$("#AffectedBusinessUnits").multiselect({buttonWidth:"100%"});$("#ComplianceRelevant").multiselect({buttonWidth:"100%"});const t=document.getElementById("Id").value,n=document.getElementById("SubmittedForReview").value,i=document.getElementById("CancelledOn").value,u=$("input[name='PmoReviewExecutionType']:checked").val();i&&($("#demandRequestForm :input").prop("disabled",!0),$(".datepicker").datepicker("disable"),$("span.input-group-text:has(i.fa-calendar)").removeClass("cursor-pointer"),$(document).off("click","span.input-group-text:has(i.fa-user)",peoplePickerFunc),$(document).off("click","div.input-group-overlay:has(i.fa-times)",clearPeoplePicker),$("span.input-group-text:has(i.fa-user)").removeClass("cursor-pointer"),$("div.input-group-overlay:has(i.fa-times)").removeClass("cursor-pointer"));t<1&&$("#demandIdDisplay").hide();n==="False"&&t>0&&!i&&showStatusAlert('<i class="fa fa-exclamation-circle" aria-hidden="true"><\/i> This Demand Request has been saved but not yet submitted for review by the Corporate IT Project Management Office.',"warning");n!=="True"||u||showStatusAlert('<i class="fa fa-info-circle" aria-hidden="true"><\/i> This Demand Request is currently awaiting review by the Corporate IT Project Management Office.',"info");document.getElementById("executiveDescCharsCount").innerHTML=document.getElementById("ExecutiveShortDescription").value.length;document.getElementById("demandNameCharsCount").innerHTML=document.getElementById("Name").value.length;const f=$("#ApplicationTypeId option:selected").text();f!=="Local"&&$("#localApplicationRow").hide();isMedicalValidationSelected()||$("#medicalReferenceCol").hide();const r=$("#RequestCorrections option:selected").val();if(r==="false"&&$("#requestCorrectionsCommentsRow").hide(),$("#BusinessProcessL2Id > option").length<=1&&$("#BusinessProcessL2Id").prop("disabled",!0),$("#BusinessProcessL3Id > option").length<=1&&$("#BusinessProcessL3Id").prop("disabled",!0),SetBusinessDriverRequiredIndicators(),r==="false")$("#requestedCorrectionsAlert").hide();else{let n="";document.getElementById("RequestCorrectionsByDisplayName")&&(n=document.getElementById("RequestCorrectionsByDisplayName").value);let t="";document.getElementById("RequestCorrectionsDate")&&(t=document.getElementById("RequestCorrectionsDate").value);$("#requestedCorrectionsAlert").html("<a class='close' data-bs-dismiss='alert'><\/a><p style='margin-bottom: 0px;'><i class='fa fa-info-circle'><\/i> Corrections were requested for this Demand by <strong>"+n+"<\/strong> on <strong>"+t+"<\/strong>.<\/p>")}n==="True"&&($("#btnSaveSubmit").hide(),$("#saveInstructions").hide())});$("#btnAddAttachment").click(function(n){addAttachmentRow($("#attachmentTable"),null);toggleAttachmentMsg();n.preventDefault()});$(document).off("click","#attachmentTable .deleteRow");$(document).on("click","#attachmentTable .deleteRow",function(n){deleteAttachmentRow($(this),"Are you sure you want to delete this File Attachment?");toggleAttachmentMsg();n.preventDefault()});$(document).off("change",":file");$(document).on("change",":file",function(){let n=$(this),t=0,i="unknown.txt";n[0].files.length>0&&(t=n[0].files[0].size,i=n[0].files[0].name);let r=$(this).closest("td").siblings(".file-size-cell").find("span.file-size-display");r.text(formatBytes(t,1))});